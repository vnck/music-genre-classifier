# Music Genre Classification

A containerized music genre classifier that classifies songs into genres provided a set of precomputed audio features.

## Data

There are 8 distinct genres:
1. Soul and Reggae
2. Pop
3. Punk
4. Jazz and Blues
5. Dance and Electronica
6. Folk
7. Classic Pop and Rock
8. Metal

The features are:
* trackID: unique identifier for each song (Maps features to their labels)
* title: title of the song. Type: text.
* tags: A comma-separated list of tags representing the words that appeared in the lyrics of the song and are assigned by human annotators. Type: text / categorical.
* loudness: overall loudness in dB. Type: float / continuous.
* tempo: estimated tempo in beats per minute (BPM). Type: float / continuous.
* time_signature: estimated number of beats per bar. Type: integer.
* key: key the track is in. Type: integer/ nominal. 
* mode: major or minor. Type: integer / binary.
* duration: duration of the song in seconds. Type: float / continuous.
* vect_1 ... vect_148: 148 columns containing pre-computed audio features of each song. 
	- These features were pre-extracted (NO TEMPORAL MEANING) from the 30 or 60 second snippets, and capture timbre, chroma, and mfcc aspects of the audio. \
	- Each feature takes a continuous value. Type: float / continuous.

## Usage

### 1. Clone the directory

```bash
git clone https://github.com/vnck/music-genre-classifier
cd music-genre-classification
```

### 2. Generate Model

Run notebook `notebooks/2021-08-09_model-production.ipynb` to produce the production model into `src/models`.

Edit the `model_path` string in `configs/configs.yaml`.

### 3. (Optional) Run Tests

1. Create a Python 3.7 environment

```bash
conda create -n music-genre-classification python=3.7
conda activate music-genre-classification
```

2. Install dependencies

```bash
pip install -r requirements.txt
```

3. Runs tests

```bash
python test/test.py
```

### 4. Deploy with `docker-compose`

```bash
cd docker
docker-compose up --build
```

You can then use `curl` to access the available APIs. E.g.
```bash
curl http://0.0.0.0:8000/add/songs -F 'file=@song.csv'
[{"title":"You Get What You Give","id":6732,"genre":{"name":"classic pop and rock"}}]
```

When done, shut down the container with:
```bash
docker-compose down
```

## Available APIs

For detailed documentation, view [http://0.0.0.0:8000/docs] generated by FastAPI.

1. Get all genres

```bash
curl http://0.0.0.0:8000/genres                             
["classic pop and rock","dance and electronica","metal","punk","folk","soul and reggae","jazz and blues"]
```

2. Get all songs

```bash
curl http://0.0.0.0:8000/songs
["lucky to be me","Hurricane","Airplanes","Huelo A Soledad","Shine",...]
```

2. Get songs by genre

```bash
curl http://0.0.0.0:8000/songs/folk
["Queen Of Love","Chase Dem","HUSTLER","Consumed By The Dead","They Killed Him","Say You Want It All (Album Version)",...]
```

3. Get songs by trackID

```bash
curl http://0.0.0.0:8000/song/track/23
["Queen Of Love"]
```
